{% extends 'nucleo.html' %}
{% load staticfiles %}

{% block content %}
<div class="col-md-12">
                            <div class="card">
                                <div class="card-header card-header-icon" data-background-color="red">
                                    <i class="material-icons">assignment</i>
                                </div>
                                <div class="card-content">
                                    <h4 class="card-title">Administrador de Pagos</h4>
                                    <a href="{% url 'export_excel2' %}"><button type="button" class="btn btn-danger btn-block"><i class="material-icons">cloud_download</i>Exportar</button></a>
                                    <div class="table-responsive">
                                        <table class="table">
                                            <thead>
                                                <tr>
                                                    <th class="text-center">#</th>
                                                    <th>Usuario</th>
                                                    <th>Proyecto / Referencia</th>
                                                    <th>Fecha</th>
                                                    <th class="text-right">Moneda</th>
                                                    <th class="text-right">Total</th>
                                                    
                                                    <th class="text-right">Estatus</th>
                                                    <th class="text-right">Acciones </th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                               
                                              {% for gasto in gastos %}  
                                                <tr>
                                                    
                                                    <td>{{gasto.id}}</td>
                                                    <td>{{gasto.comprador}}</td>
                                                    <td>{{gasto.referencia}}</td>
                                                    <td class="text-left">{{gasto.fecha|date:'d-m-y'}}</td>
                                                    <td class="text-right">{{gasto.moneda}}</td>
                                                    <td class="text-right">{{gasto.total_final}}</td>
                                                    


                                                    <td class="text-right">
                                                      
                                                      {% if gasto.estatus == "Abierto" %}
                                                      <span class="label label-warning">{{gasto.estatus}}</span>
                                                      {% elif gasto.estatus == "PROCESADO" %}
                                                      <span class="label label-success">{{gasto.estatus}}</span>
                                                      {% else %}
                                                      <span class="label label-danger">{{gasto.estatus}}</span>

                                                  
                                                      {% endif %}
                                                    
                                                    </td>
                                                    <td class="td-actions text-right">
                                                        {% if gasto.estatus != "PROCESADO" %}
                                                        <button type="button"  rel="tooltip" class="btn btn-info " onclick="Pay({{gasto.id}})">
                                                            <i class="material-icons">monetization_on</i>
                                                        </button>
                                                        <a href="/detalleadmin/{{gasto.id}}"><button type="button"  rel="tooltip" class="btn btn-warning " >
                                                            <i class="material-icons"><i class="material-icons">remove_red_eye</i></i>
                                                        </button></a>
                                                        
                                                       <button type="button" onclick="Remove()" rel="tooltip" class="btn btn-danger " data-original-title="" title="">
                                                            <i class="material-icons">close</i>
                                                        </button>
                                                         {% elif gasto.estatus == "PROCESADO" %}
                                                         <a href="/detalleadmin/{{gasto.id}}"><button type="button"  rel="tooltip" class="btn btn-warning " >
                                                            <i class="material-icons"><i class="material-icons">remove_red_eye</i></i>
                                                        </button></a>
                                                        
                                                       <button type="button" onclick="Remove()" rel="tooltip" class="btn btn-danger " data-original-title="" title="">
                                                            <i class="material-icons">close</i>
                                                        </button>
                                                         {% endif %}
                                                    </td>
                                                </tr>
                                               

                                                <!-- Modal -->
                                                <div id="myModal{{gasto.id}}" class="modal fade" role="dialog">
                                                  <div class="modal-dialog">

                                                    <!-- Modal content-->
                                                    <div class="modal-content">
                                                      <div class="modal-header">
                                                        <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                        <div style="text-align: center"><h4 class="modal-title"> Modulo de pago #{{gasto.id}}</h4></div>
                                                      </div>
                                                      <div class="modal-body">
                                                        
                                                      </div>
                                                      <div class="modal-footer">
                                                        <button type="button" class="btn btn-danger" data-dismiss="modal">Pagar Gasto</button>
                                                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                                                      </div>
                                                    </div>

                                                  </div>
                                                </div>


                                               {% endfor %}
                                              
                                                
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                                    </div>
                                </form>
                            </div>



                        <script type="text/javascript">
                        	function Pay(id) {
                                                         
                                           console.log(id);


                                           $.ajax({
                                                            data: { csrfmiddlewaretoken: '{{ csrf_token }}','id':id},
                                                            url: '{% url 'paygasto'  %}',
                                                            type: 'POST',
                                                            success : function(data) {
                                                                   window.location.reload();
                                                                               },
                                                            error : function(message) {
                                                                   console.log(message);
                                                            }
                                                             });

                                                        
                                                         }
                        </script>



{% endblock %}